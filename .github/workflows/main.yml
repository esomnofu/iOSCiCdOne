name: CI/CD for iOS

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    name: Build and analyze and test using xcodebuild command
    runs-on: macOS-latest

    steps:
    - uses: actions/checkout@master
    - uses: uses: actions/checkout@v3
      with:
        xcode-version: '15.4' # Exact version of a Xcode version to use
        apple-id: 'mresomnofu@gmail.com' # Apple ID to download from Apple Developer when Xcode not available in local
        apple-id-password: ${{ secrets.APPLE_ID_PASSWORD }}
    - run: fastlane scan
    
    
#    steps:
#    - name: Checkout repository
#      uses: actions/checkout@v3
#
##    - name: Set up Xcode
##      uses: actions/setup-xcode@v3
##      with:
##        xcode-version: '12.0' # Choose the appropriate version
#
#    - name: Install dependencies
#      run: |
#        bundle install
#        bundle exec fastlane install_plugins
#
#    - name: Build and test
#      run: bundle exec fastlane build_and_test

  deploy:
    runs-on: macOS-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Xcode
      uses: actions/setup-xcode@v4
      with:
        xcode-version: '12.0' # Choose the appropriate version

    - name: Install dependencies
      run: |
        bundle install
        bundle exec fastlane install_plugins

    - name: Upload to TestFlight
      run: bundle exec fastlane upload_to_testflight

    # - name: Deploy to App Store
    #   run: bundle exec fastlane deploy_to_app_store
